<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scaffolding Attendance & Productivity</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      background: #f2f2f2;
    }
    .container {
      max-width: 520px;
      margin: auto;
      padding: 12px;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,.1);
    }
    h2 {
      margin-top: 0;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      background: #000;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }
    .row {
      display: flex;
      gap: 8px;
    }
    .row > * {
      flex: 1;
    }
    textarea {
      height: 140px;
    }
  </style>
</head>

<body>
<div class="container">

  <!-- CHECK IN -->
  <div class="card">
    <h2>ðŸŸ¢ Check-In</h2>

    <input id="ciUser" placeholder="Supervisor Username">
    <input id="ciPass" type="password" placeholder="Passcode">

    <select id="ciProject"></select>
    <select id="ciWorker"></select>

    <button onclick="checkIn()">Submit Check-In</button>

    <textarea id="ciReport" placeholder="Check-In Report"></textarea>
    <button onclick="copyText('ciReport')">Copy</button>
    <button onclick="shareWhatsApp('ciReport')">WhatsApp</button>
  </div>

  <!-- CHECK OUT -->
  <div class="card">
    <h2>ðŸ”µ Check-Out</h2>

    <input id="coUser" placeholder="Supervisor Username">
    <input id="coPass" type="password" placeholder="Passcode">

    <select id="coProject"></select>

    <select id="area"></select>
    <select id="jobType"></select>
    <select id="scaffoldType"></select>
    <select id="elevation"></select>

    <div class="row">
      <input id="l" placeholder="Length">
      <input id="w" placeholder="Width">
    </div>

    <div class="row">
      <input id="h" placeholder="Height">
      <input id="q" placeholder="Quantity">
    </div>

    <input id="manpower" placeholder="Total Manpower">

    <button onclick="checkOut()">Submit Check-Out</button>

    <textarea id="coReport" placeholder="Daily Report"></textarea>
    <button onclick="copyText('coReport')">Copy</button>
    <button onclick="shareWhatsApp('coReport')">WhatsApp</button>
  </div>

</div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbzRHfgr74_zXY3sAOKgNrUTW_kJI4sJRytXbtaIc-CXaetgoYYX16nf3Vp_LIDQnX4A/exec";

async function loadInit() {
  const res = await fetch(GAS_URL + "?action=init");
  const data = await res.json();

  fill("ciProject", data.projects);
  fill("coProject", data.projects);
  fill("ciWorker", data.workers);

  fill("area", data.area);
  fill("jobType", data.jobType);
  fill("scaffoldType", data.scaffoldType);
  fill("elevation", data.elevation);
}

function fill(id, arr) {
  const el = document.getElementById(id);
  el.innerHTML = "<option value=''>Select</option>";
  arr.forEach(v => {
    const o = document.createElement("option");
    o.value = v;
    o.textContent = v;
    el.appendChild(o);
  });
}

async function checkIn() {
  const payload = {
    action: "checkIn",
    user: ciUser.value,
    pass: ciPass.value,
    project: ciProject.value,
    worker: ciWorker.value
  };
  const res = await fetch(GAS_URL, {
    method: "POST",
    body: JSON.stringify(payload)
  });
  ciReport.value = await res.text();
}

async function checkOut() {
  const payload = {
    action: "checkOut",
    user: coUser.value,
    pass: coPass.value,
    project: coProject.value,
    area: area.value,
    jobType: jobType.value,
    scaffoldType: scaffoldType.value,
    elevation: elevation.value,
    l: +l.value,
    w: +w.value,
    h: +h.value,
    q: +q.value,
    manpower: +manpower.value
  };
  const res = await fetch(GAS_URL, {
    method: "POST",
    body: JSON.stringify(payload)
  });
  coReport.value = await res.text();
}

function copyText(id) {
  const t = document.getElementById(id);
  t.select();
  document.execCommand("copy");
}

function shareWhatsApp(id) {
  const txt = encodeURIComponent(document.getElementById(id).value);
  window.open("https://wa.me/?text=" + txt);
}

loadInit();
</script>
</body>
</html>
